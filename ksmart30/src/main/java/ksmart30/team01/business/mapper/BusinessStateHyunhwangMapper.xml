<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ksmart30.team01.business.mapper.BusinessStateHyunhwangMapper">
	<!-- 10.2.5.계정과목코드
	   @file   AccountCodeMapper.xml
	   @brief   계정과목코드 XML
	   @author  ksmart30 박찬업
	-->
	
	<!-- 1.3.1.진행/종료 현황.설계본부1 사업성검토 리스트
		  @brief    설계본부1 사업성검토 리스트 SELECT쿼리문
		  @return  ksmart30.team00.baseinfo.domain.TotalCode
	-->
	<select id="getBusinessState1BonbuHyunhwangInfo"
			resultType="ksmart30.team00.baseinfo.domain.TotalCode">
				SELECT 
					'설계1본부'     SYS_COD
					,A.LEVEL2_CD
					,A.LEVEL2_NM
					,ISNULL(B.BIZ1,0) BIZ1
					,ISNULL(B.BIZ2,0) BIZ2
					,ISNULL(B.TOTL,0) TOTL
				FROM 
					T_SC9100 A LEFT OUTER JOIN (
					SELECT 
						A.BIZ_GBN
						,SUM(CASE A.ACT_STAT WHEN '1' THEN 1 ELSE 0   END) BIZ1
						,SUM(CASE A.ACT_STAT WHEN '2' THEN 1 ELSE 0   END) BIZ2
						,COUNT(A.ACT_STAT)                                 TOTL
					FROM 
						T_PS1000 A
						INNER JOIN 
							SF_SC1010 ('03','','7500','') B
						ON 
							A.DEPT_CD = B.DEPT_CD
					<![CDATA[
					WHERE 
						A.ACT_STAT IN ('1','2') AND A.CRT_DATE <= 'now()'
					]]>
					GROUP BY 
						A.BIZ_GBN  ) B
					ON 
						A.LEVEL2_CD = B.BIZ_GBN
				WHERE 
					A.BUSI_GB ='J'
				AND   
					A.LEVEL1_CD ='270'	
	</select>
	
	<!-- 1.3.1.진행/종료 현황.설계본부2 사업성검토 리스트
		  @brief    설계본부2 사업성검토 리스트 SELECT쿼리문
		  @return  ksmart30.team00.baseinfo.domain.TotalCode
	-->
	<select id="getBusinessState2BonbuHyunhwangInfo"
			resultType="ksmart30.team00.baseinfo.domain.TotalCode">
				SELECT 
					'설계2본부'     SYS_COD
					,A.LEVEL2_CD
					,A.LEVEL2_NM
					,ISNULL(B.BIZ1,0) BIZ1
					,ISNULL(B.BIZ2,0) BIZ2
					,ISNULL(B.TOTL,0) TOTL
				FROM 
					T_SC9100 A LEFT OUTER JOIN (
					SELECT 
						A.BIZ_GBN
						,SUM(CASE A.ACT_STAT WHEN '1' THEN 1 ELSE 0   END) BIZ1
						,SUM(CASE A.ACT_STAT WHEN '2' THEN 1 ELSE 0   END) BIZ2
						,COUNT(A.ACT_STAT)                                 TOTL
					FROM 
						T_PS1000 A
						INNER JOIN 
							SF_SC1010 ('03','','7600','') B
						ON 
							A.DEPT_CD = B.DEPT_CD
					<![CDATA[
					WHERE 
						A.ACT_STAT IN ('1','2') AND A.CRT_DATE <= 'now()'
					]]>
					GROUP BY 
						A.BIZ_GBN  ) B
					ON 
						A.LEVEL2_CD = B.BIZ_GBN
				WHERE 
					A.BUSI_GB ='J'
				AND   
					A.LEVEL1_CD ='270'	
	</select>
	
	<!-- 1.3.1.진행/종료 현황.설계본부3 사업성검토 리스트
		  @brief    설계본부3 사업성검토 리스트 SELECT쿼리문
		  @return  ksmart30.team00.baseinfo.domain.TotalCode
	-->
	<select id="getBusinessState3BonbuHyunhwangInfo"
			resultType="ksmart30.team00.baseinfo.domain.TotalCode">
				SELECT 
					'설계3본부'     SYS_COD
					,A.LEVEL2_CD
					,A.LEVEL2_NM
					,ISNULL(B.BIZ1,0) BIZ1
					,ISNULL(B.BIZ2,0) BIZ2
					,ISNULL(B.TOTL,0) TOTL
				FROM 
					T_SC9100 A LEFT OUTER JOIN (
					SELECT 
						A.BIZ_GBN
						,SUM(CASE A.ACT_STAT WHEN '1' THEN 1 ELSE 0   END) BIZ1
						,SUM(CASE A.ACT_STAT WHEN '2' THEN 1 ELSE 0   END) BIZ2
						,COUNT(A.ACT_STAT)                                 TOTL
					FROM 
						T_PS1000 A
						INNER JOIN 
							SF_SC1010 ('03','','7700','') B
						ON 
							A.DEPT_CD = B.DEPT_CD
					<![CDATA[
					WHERE 
						A.ACT_STAT IN ('1','2') AND A.CRT_DATE <= 'now()'
					]]>
					GROUP BY 
						A.BIZ_GBN  ) B
					ON 
						A.LEVEL2_CD = B.BIZ_GBN
				WHERE 
					A.BUSI_GB ='J'
				AND   
					A.LEVEL1_CD ='270'	
	</select>
	
	<!-- 1.3.1.진행/종료 현황.설계본부4 사업성검토 리스트
		  @brief    설계본부4 사업성검토 리스트 SELECT쿼리문
		  @return  ksmart30.team00.baseinfo.domain.TotalCode
	-->
	<select id="getBusinessState4BonbuHyunhwangInfo"
			resultType="ksmart30.team00.baseinfo.domain.TotalCode">
				SELECT 
					'설계4본부'     SYS_COD
					,A.LEVEL2_CD
					,A.LEVEL2_NM
					,ISNULL(B.BIZ1,0) BIZ1
					,ISNULL(B.BIZ2,0) BIZ2
					,ISNULL(B.TOTL,0) TOTL
				FROM 
					T_SC9100 A LEFT OUTER JOIN (
					SELECT 
						A.BIZ_GBN
						,SUM(CASE A.ACT_STAT WHEN '1' THEN 1 ELSE 0   END) BIZ1
						,SUM(CASE A.ACT_STAT WHEN '2' THEN 1 ELSE 0   END) BIZ2
						,COUNT(A.ACT_STAT)                                 TOTL
					FROM 
						T_PS1000 A
						INNER JOIN 
							SF_SC1010 ('03','','7800','') B
						ON 
							A.DEPT_CD = B.DEPT_CD
					<![CDATA[
					WHERE 
						A.ACT_STAT IN ('1','2') AND A.CRT_DATE <= 'now()'
					]]>
					GROUP BY 
						A.BIZ_GBN  ) B
					ON 
						A.LEVEL2_CD = B.BIZ_GBN
				WHERE 
					A.BUSI_GB ='J'
				AND   
					A.LEVEL1_CD ='270'	
	</select>
	
	<!-- 1.3.1.진행/종료 현황.설계본부5 사업성검토 리스트
		  @brief    설계본부5 사업성검토 리스트 SELECT쿼리문
		  @return  ksmart30.team00.baseinfo.domain.TotalCode
	-->
	<select id="getBusinessState5BonbuHyunhwangInfo"
			resultType="ksmart30.team00.baseinfo.domain.TotalCode">
				SELECT 
					'설계5본부'     SYS_COD
					,A.LEVEL2_CD
					,A.LEVEL2_NM
					,ISNULL(B.BIZ1,0) BIZ1
					,ISNULL(B.BIZ2,0) BIZ2
					,ISNULL(B.TOTL,0) TOTL
				FROM 
					T_SC9100 A LEFT OUTER JOIN (
					SELECT 
						A.BIZ_GBN
						,SUM(CASE A.ACT_STAT WHEN '1' THEN 1 ELSE 0   END) BIZ1
						,SUM(CASE A.ACT_STAT WHEN '2' THEN 1 ELSE 0   END) BIZ2
						,COUNT(A.ACT_STAT)                                 TOTL
					FROM 
						T_PS1000 A
						INNER JOIN 
							SF_SC1010 ('03','','7900','') B
						ON 
							A.DEPT_CD = B.DEPT_CD
					<![CDATA[
					WHERE 
						A.ACT_STAT IN ('1','2') AND A.CRT_DATE <= 'now()'
					]]>
					GROUP BY 
						A.BIZ_GBN  ) B
					ON 
						A.LEVEL2_CD = B.BIZ_GBN
				WHERE 
					A.BUSI_GB ='J'
				AND   
					A.LEVEL1_CD ='270'	
	</select>
	
	<!-- 1.3.1.진행/종료 현황.진행상태 리스트
		  @brief    설계본부1 사업성검토 리스트 SELECT쿼리문
		  @return  ksmart30.team00.baseinfo.domain.TotalCode
	-->
	<select id="getBusinessStateJinhaengHyunhwangInfo"
			resultType="ksmart30.team01.business.domain.BusinessStateJinhaengHyunhwangDomain">
				SELECT 
					DEPT_CD       ,
					DEPT_NM       ,
					SYS_COD       ,
					SYS_COD2      ,
					PRE_PJT_CD    ,
					PJT_CD        ,
					SVC           ,
					CUST_NM       ,
					BIZ_GBN_NM    ,
					END_EXP_DATE  ,
					EMP_NM        ,
					PM_EMP_NM     ,
					INGUN_AMT     ,
					COST_AMT      ,
					SCV_AMT       ,
					TOT_AMT       ,
					ACT_STAT      ,
					ACT_STAT_NM   ,
					END_DATE      ,
					END_GBN       ,
					END_GBN_NM    ,
					COLOR
				FROM 
					SF_BIZ_STAT_TAB1('7500','01','1','now()')
				ORDER BY 
					SYS_COD,
					SYS_COD2,
					PJT_CD
	</select>

	<!-- 1.3.1.진행/종료 현황-수주구분별 리스트 조회
		  @brief    설계본부1 사업성검토 리스트 SELECT쿼리문
		  @return  ksmart30.team00.baseinfo.domain.TotalCode
	-->
	<select id="getSujuGubunInfo"
			parameterType="ksmart30.team00.baseinfo.domain.TotalCode"
			resultType="ksmart30.team01.business.domain.BusinessStateJinhaengHyunhwangDomain">
				SELECT 
					DEPT_CD       ,
					DEPT_NM       ,
					SYS_COD       ,
					SYS_COD2      ,
					PRE_PJT_CD    ,
					PJT_CD        ,
					SVC           ,
					CUST_NM       ,
					BIZ_GBN_NM    ,
					END_EXP_DATE  ,
					EMP_NM        ,
					PM_EMP_NM     ,
					INGUN_AMT     ,
					COST_AMT      ,
					SCV_AMT       ,
					TOT_AMT       ,
					ACT_STAT      ,
					ACT_STAT_NM   ,
					END_DATE      ,
					END_GBN       ,
					END_GBN_NM    ,
					COLOR
				FROM 
					SF_BIZ_STAT_TAB1(#{SYS_COD},'','','now()')
				WHERE BIZ_GBN_NM = #{LEVEL2_NM}	
				ORDER BY 
					SYS_COD,
					SYS_COD2,
					PJT_CD
	</select>

	<!-- 1.3.1.진행/종료 현황-진행상태별 리스트
		  @brief    설계본부1 사업성검토 리스트 SELECT쿼리문
		  @return  ksmart30.team00.baseinfo.domain.TotalCode
	-->
	<select id="getJinhaengSangtaeInfo"
			parameterType="ksmart30.team01.business.domain.BusinessStateJinhaengHyunhwangDomain"
			resultType="ksmart30.team01.business.domain.BusinessStateJinhaengHyunhwangDomain">
				SELECT 
					DEPT_CD       ,
					DEPT_NM       ,
					SYS_COD       ,
					SYS_COD2      ,
					PRE_PJT_CD    ,
					PJT_CD        ,
					SVC           ,
					CUST_NM       ,
					BIZ_GBN_NM    ,
					END_EXP_DATE  ,
					EMP_NM        ,
					PM_EMP_NM     ,
					INGUN_AMT     ,
					COST_AMT      ,
					SCV_AMT       ,
					TOT_AMT       ,
					ACT_STAT      ,
					ACT_STAT_NM   ,
					END_DATE      ,
					END_GBN       ,
					END_GBN_NM    ,
					COLOR
				FROM 
					SF_BIZ_STAT_TAB1(#{DEPT_CD},'',#{ACT_STAT},'now()')
					
				ORDER BY 
					SYS_COD,
					SYS_COD2,
					PJT_CD
	</select>
</mapper>